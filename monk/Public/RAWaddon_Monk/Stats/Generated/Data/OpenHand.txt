// Whenever you hit a creature with one of the attacks granted by your Flurry of Blows, you can impose one of the following effects on that target.
new entry "OpenHandTechnique_Passive"
type "PassiveData"
data "DisplayName" "0bf29def-3c66-46c6-af22-37612e0a5f0c;1"
data "Description" "71814ea6-fd14-4c94-a41e-e2735b22b8ec;1"
data "TooltipUseCosts" "KiPoint:1"
data "Icon" "Action_Monk_OpenHandTechnique_Knock"
data "Properties" "Highlighted;IsToggled;ToggledDefaultAddToHotbar"
data "Boosts" "UnlockInterrupt(Interrupt_OpenHandTechnique_Knock);UnlockInterrupt(Interrupt_OpenHandTechnique_Push);UnlockInterrupt(Interrupt_OpenHandTechnique_NoReactions)"

new entry "OpenHandTechnique_Interrupt"
type "InterruptData"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and Self(context.Source,context.Observer) and IsMeleeUnarmedAttack() and not IsMiss() and not AnyEntityIsItem() and not IsKillingBlow() and (IsSpellChildOrVariantFromContext('Target_FlurryOfBlows_FirstAttack') or IsSpellChildOrVariantFromContext('Target_FlurryOfBlows_LastAttack'))"
data "CastTextEvent" "Cast"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')"
data "EnableContext" "OnStatusApplied;OnStatusRemoved"

// It must succeed on a Dexterity saving throw or be knocked prone.
new entry "Interrupt_OpenHandTechnique_Knock"
type "InterruptData"
using "OpenHandTechnique_Interrupt"
data "Icon" "Action_Monk_OpenHandTechnique_Knock"
data "DisplayName" "5d781faa-a7de-4575-85de-cf3987b6b99e;2"
data "Description" "00f6f980-a661-4831-abf6-65dd3c0332cf;5"
data "TooltipAttackSave" "Dexterity"
data "TooltipStatusApply" "ApplyStatus(PRONE,100,1)"
data "TargetSound" "Spell_Impact_Monk_OpenHandTech_L1to3"
data "Properties" "IF(not SavingThrow(Ability.Dexterity, WisdomSaveDC())):ApplyStatus(PRONE,100,1)"

// It must make a Strength saving throw. If it fails, you can push it up to 15 feet away from you.
new entry "Interrupt_OpenHandTechnique_Push"
type "InterruptData"
using "OpenHandTechnique_Interrupt"
data "Icon" "Action_Monk_OpenHandTechnique_Push"
data "DisplayName" "2466697e-daab-4ccf-81b9-46041e56b176;2"
data "Description" "e7464e4f-10ca-4234-ac73-494836d2fa9d;5"
data "DescriptionParams" "Distance(4.5)"
data "TooltipAttackSave" "Strength"
data "TargetSound" "Spell_Impact_Monk_OpenHandTech_L1to3"
data "Properties" "IF(not SavingThrow(Ability.Strength, WisdomSaveDC())):ApplyStatus(OPEN_HAND_TECHNIQUE_PUSHED,100,1)"

new entry "OPEN_HAND_TECHNIQUE_PUSHED"
type "StatusData"
data "StatusType" "EFFECT"
data "DisplayName" "0c6234f8-f4bf-420b-8f57-935a65736252;1"
data "OnApplyFunctors" "Force(4.5)"
data "StatusPropertyFlags" "ApplyToDead;AddFallDamageOnLand;DisableOverhead;DisablePortraitIndicator"

// It can't take reactions until the end of your next turn.
new entry "Interrupt_OpenHandTechnique_NoReactions"
type "InterruptData"
using "OpenHandTechnique_Interrupt"
data "Icon" "Action_Monk_OpenHandTechnique_NoReactions"
data "DisplayName" "c0b40fe2-a30b-40f9-8f88-d9209a0e2f2b;2"
data "Description" "922b53c6-37ab-422d-94b1-0ac6aad87ef1;6"
data "TooltipStatusApply" "ApplyStatus(OPEN_HAND_NO_REACTIONS,100,1)"
data "TargetSound" "Spell_Impact_Monk_OpenHandTech_L1to3"
data "Properties" "ApplyStatus(OPEN_HAND_NO_REACTIONS,100,1)"

// Wholeness Of Body, keep only the healing part. 
new entry "Shout_WholenessOfBody"
type "SpellData"
using "Shout_WholenessOfBody"
data "SpellProperties" "RegainHitPoints(3*ClassLevel(Monk))"
data "Description" "275e8029-c20c-4625-b628-03fdd1257466;7"
data "TooltipDamageList" "RegainHitPoints(3*ClassLevel(Monk))"
data "TooltipStatusApply" ""
data "UseCosts" "ActionPoint:1"

// Tranquility lasts until long rest
new entry "Tranquility"
type "PassiveData"
using "Tranquility"
data "StatsFunctors" "ApplyStatus(SELF,SANCTUARY_TRANQUILITY,100,-1)"

// Lesser Quivering Palm
new entry "KiResonation_Passive"
type "PassiveData"
data "Icon" "Action_KiResonation_Punch"
data "DisplayName" "20e0049c-c134-46d5-afd4-f7f3685bf794;2"
data "Description" "d13b42e1-0793-40eb-8e47-49e12b60baef;3"
data "DescriptionParams" "2"
data "ExtraDescription" ""
data "TooltipUseCosts" "KiPoint:2"
data "Properties" "Highlighted;IsToggled;ToggledDefaultAddToHotbar"
data "Boosts" "UnlockInterrupt(Interrupt_KiResonation)"

new entry "Interrupt_KiResonation"
type "InterruptData"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "InterruptDefaultValu&e" "Ask;Enabled"
data "Container" "YesNoDecision"
data "DisplayName" "bcf9b273-5e86-436b-94f4-b539e6495c67;2"
data "Description" "7789c49d-d9b0-4fd2-a88a-92055e539ef9;3"
data "TooltipStatusApply" "ApplyStatus(KI_RESONATION, 100, -1)"
data "TooltipUseCosts" "KiPoint:2"
data "Icon" "Action_KiResonation_Punch"
data "Conditions" "not Item() and Self(context.Source,context.Observer) and not Self(context.Source,context.Target) and IsMeleeAttack() and IsUnarmedAttack() and not HasStatus('KI_RESONATION') and HasDamageEffectFlag(DamageFlags.Hit) and not IsKillingBlow()"
//data "Properties" "UseSpell(OBSERVER_TARGET,Target_KiResonation_Punch,true,true,true)"
data "Properties" "ApplyStatus(KI_RESONATION, 100, -1)
data "Cost" "KiPoint:2"
data "EnableCondition" "not HasStatus('SG_Polymorph') or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')"
data "EnableContext" "OnStatusApplied;OnStatusRemoved"

new entry "Target_KiResonation_Punch"
type "SpellData"
using "Target_KiResonation_Punch"
data "SpellSuccess" "ApplyStatus(KI_RESONATION, 100, -1)"
data "Description" "7789c49d-d9b0-4fd2-a88a-92055e539ef9;3"
data "TooltipStatusApply" "ApplyStatus(KI_RESONATION, 100, -1)"

new entry "Target_KiResonation_Blast"
type "SpellData"
using "Target_KiResonation_Blast"
data "Cooldown" ""
data "SpellProperties" "RemoveStatus(KI_RESONATION)"
data "SpellRoll" "not SavingThrow(Ability.Constitution, WisdomSaveDC())"
data "SpellSuccess" "DealDamage(5d10, Necrotic, Magical)" 
data "SpellFail" "DealDamage((5d10)/2, Necrotic, Magical)"
data "TargetRadius" "18"
data "AreaRadius" "0"
data "DisplayName" "8d1c4c37-d27f-4949-90b5-dbeff5f9a93e;1"
data "Description" "156f3e5d-81fd-4447-8bcc-33da80252072;3"
data "DescriptionParams" "5d10"
data "ExtraDescription" ""
data "TooltipDamageList" "DealDamage(5d10, Necrotic)"
data "TooltipAttackSave" "Constitution"
data "UseCosts" "ActionPoint:1"
data "SpellFlags" "IsHarmful"
data "DamageType" "Necrotic"

new entry "KI_RESONATION"
type "StatusData"
using "KI_RESONATION"
data "DisplayName" "hf3a73818g3b39g454dgb194g9d186c0c6423;3"
data "Description" "c516018a-0e11-4554-a3fd-a26c6bcd4c96;3"
data "OnRemoveFunctors" ""

